(function(e){function t(t){for(var n,o,c=t[0],s=t[1],u=t[2],d=0,p=[];d<c.length;d++)o=c[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);l&&l(t);while(p.length)p.shift()();return r.push.apply(r,u||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],n=!0,c=1;c<a.length;c++){var s=a[c];0!==i[s]&&(n=!1)}n&&(r.splice(t--,1),e=o(o.s=a[0]))}return e}var n={},i={app:0},r=[];function o(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=n,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(a,n,function(t){return e[t]}.bind(null,n));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="https://cdn.jsdelivr.net/gh/yuqianma/ncov-map@gh-pages/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;r.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var n=a("85ec"),i=a.n(n);i.a},"0b85":function(e,t,a){},"0c08":function(e,t,a){"use strict";var n=a("b309"),i=a.n(n);i.a},1807:function(e,t,a){"use strict";var n=a("fb05"),i=a.n(n);i.a},"2d5e":function(e,t,a){"use strict";var n=a("6a61"),i=a.n(n);i.a},"45d9":function(e,t,a){"use strict";var n=a("0b85"),i=a.n(n);i.a},"4ff7":function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("router-view",{staticClass:"blur-box",class:e.showAbout?"blur":"no-blur"}),e.showAbout?a("div",{staticClass:"about",on:{click:function(t){e.showAbout=!1}}},[a("About",{staticClass:"content"})],1):e._e(),a("GithubCorner")],1)},r=[],o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a",{staticClass:"github-corner",attrs:{href:"https://github.com/yuqianma/ncov-map","aria-label":"View source on GitHub"}},[a("svg",{staticStyle:{fill:"#333",color:"#fff",position:"absolute",top:"0",border:"0",right:"0"},attrs:{width:"40",height:"40",viewBox:"0 0 250 250","aria-hidden":"true"}},[a("path",{attrs:{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}}),a("path",{staticClass:"octo-arm",staticStyle:{"transform-origin":"130px 106px"},attrs:{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor"}}),a("path",{staticClass:"octo-body",attrs:{d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z",fill:"currentColor"}})])])},c=[],s=(a("aca4"),a("2877")),u={},l=Object(s["a"])(u,o,c,!1,null,null,null),d=l.exports,p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{domProps:{innerHTML:e._s(e.compiledMarkdown)}})},m=[],f=(a("d3b7"),Date.now()),h={data:function(){return{readme:"#waiting..."}},created:function(){var e=this;fetch("https://cdn.jsdelivr.net/gh/yuqianma/ncov-map@master/README.md?_="+f).then((function(e){return e.text()})).then((function(t){return e.readme=t}))},computed:{compiledMarkdown:function(){return marked(this.readme)}}},v=h,y=Object(s["a"])(v,p,m,!1,null,null,null),g=y.exports,b={components:{GithubCorner:d,About:g},computed:{showAbout:{get:function(){return this.$store.state.showAbout},set:function(e){this.$store.commit("setShowAbout",e)}}}},w=b,x=(a("034f"),a("2d5e"),Object(s["a"])(w,i,r,!1,null,"13fbb819",null)),O=x.exports,_=a("8c4f"),C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home",class:[e.size,e.playing?"disable-interaction":""]},[a("div",{staticClass:"geo-map"},[a("Map")],1),a("div",{staticClass:"pane"},[a("div",{staticClass:"handle",on:{click:e.toggleSize}}),e.loading?a("Spinner"):e._e(),e.loaded?a("div",{staticClass:"control"},[a("div",{staticClass:"type-control"},[e._v(" Map type: "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.mapType,expression:"mapType"}],attrs:{type:"radio",id:"circle",name:"mapType",value:"circle"},domProps:{checked:e._q(e.mapType,"circle")},on:{change:function(t){e.mapType="circle"}}}),a("label",{attrs:{for:"circle"}},[e._v("circle")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.mapType,expression:"mapType"}],attrs:{type:"radio",id:"3D",name:"mapType",value:"3D"},domProps:{checked:e._q(e.mapType,"3D")},on:{change:function(t){e.mapType="3D"}}}),a("label",{attrs:{for:"3D"}},[e._v("3D")])]),a("div",{staticClass:"player"},[a("span",{staticClass:"prev"},[a("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"}},[a("path",{attrs:{d:"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"}}),a("path",{attrs:{d:"M0 0h24v24H0V0z",fill:"none"}})])]),a("span",{staticClass:"play",on:{click:e.togglePlay}},[e.playing?e._e():a("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"}},[a("path",{attrs:{d:"M8 5v14l11-7z"}}),a("path",{attrs:{d:"M0 0h24v24H0z",fill:"none"}})]),e.playing?a("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"}},[a("path",{attrs:{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"}}),a("path",{attrs:{d:"M0 0h24v24H0z",fill:"none"}})]):e._e()]),a("span",{staticClass:"next"},[a("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"}},[a("path",{attrs:{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"}}),a("path",{attrs:{d:"M0 0h24v24H0V0z",fill:"none"}})])])])]):e._e(),e.loaded?a("TimeMinimap"):e._e(),a("span",{staticClass:"update-time"},[e._v("update: "+e._s(e.updateTime))]),a("span",{staticClass:"about-icon",on:{click:function(t){e.showAbout=!0}}},[e._v("ⓘ 说明")])],1),a("div",{staticClass:"point-info"},[a("div",[e._v(e._s(e.dataDate)+" 累计确诊")]),a("div",[e._v(e._s(e.pointInfo))])])])},j=[],D=(a("a4d3"),a("99af"),a("4de4"),a("7db0"),a("4160"),a("e439"),a("dbb4"),a("b64b"),a("159b"),a("ade3"));a("ac1f"),a("5319");function P(e){return new Function("var window = {}; ".concat(e,"; for(let k in window) {return window[k];}"))()}function z(e){return+e.replace(/[^\d]/g,"")}var S=window.AreaStatIndex,k=z(S[S.length-1]);window.getAreaStat.time=k;var T=[new Date("2020-01-15"),new Date(k)],N=new Date("2020-01-24"),M=["#b1e5eb","#90dbfc","#e170c4","#eb1d78","#ae1233","#550000"],A={Domains:[1,10,100,500,5e3,1e4],Radii:[1,2,4,8,10,15],Colors:M},$=a("2f62"),L=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"map"},[a("div",{ref:"container",class:{"show-label":e.showLabel},attrs:{id:"map-container"}}),a("MapLegend",{staticClass:"map-legend",style:{opacity:3-e.zoom},attrs:{zoom:e.zoom}})],1)},E=[],H=(a("d81d"),a("13d5"),a("2909")),F=a("3835"),I=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"container"})},q=[],V={name:"MapLegend",props:["zoom"],mounted:function(){this.initChart()},watch:{zoom:function(e){this.view&&this.view.signal("zoom",e).runAsync()}},methods:{initChart:function(){var e=this.$refs.container;if(!this.view&&e){var t=B(),a=new vega.View(vega.parse(t),{renderer:"svg",container:e,hover:!0});a.runAsync(),this.view=a,window._legend=a}}}};function B(){return{$schema:"https://vega.github.io/schema/vega/v5.json",width:150,height:150,padding:0,data:[{name:"domains",values:A.Domains},{name:"radius",values:A.Radii,transform:[{type:"formula",as:"area",expr:"pow(scale('zoom', zoom) * datum.data * 2, 2)"}]},{name:"colors",values:A.Colors}],signals:[{name:"zoom",value:2}],scales:[{name:"zoom",domain:[2,10],range:[1,4],zero:!1,nice:!1},{name:"_size",type:"ordinal",domain:{data:"domains",field:"data"},range:{data:"radius",field:"area"}},{name:"size",type:"linear",domain:{signal:"domain('_size')"},range:{signal:"range('_size')"}},{name:"color",type:"ordinal",domain:{data:"domains",field:"data"},range:{data:"colors",field:"data"}}],legends:[{orient:"bottom-left",type:"symbol",size:"size",fill:"color",rowPadding:0,padding:-18,values:{signal:"domain('_size')"},encode:{labels:{update:{text:{signal:"datum.index === 5 ? '≥' + datum.label : datum.label "}}}}}]}}var R=V,G=(a("ea22"),Object(s["a"])(R,I,q,!1,null,"4376ced2",null)),Y=G.exports;function Z(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function W(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(a),!0).forEach((function(t){Object(D["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Z(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var J={name:"Map",components:{MapLegend:Y},data:function(){return{showLabel:!1,zoom:2}},mounted:function(){this.mapbox()},computed:W({},Object($["c"])(["mapType","paneSize"]),{},Object($["b"])(["visiblePoints"])),watch:{paneSize:function(){var e=this;this.map&&this.$nextTick((function(){return e.map.resize()}))},visiblePoints:function(e){"circle"===this.mapType?this.map.getSource("points").setData(this.dataToPointFeature(e)):this.map.getSource("polygons").setData(this.dataToPolygonFeature(e))},mapType:function(e){var t=this.map;"circle"===e?(t.getSource("points").setData(this.dataToPointFeature(this.visiblePoints)),t.setLayoutProperty("ncov-circle","visibility","visible"),t.setLayoutProperty("ncov-3d","visibility","none"),t.easeTo({pitch:0})):(t.getSource("polygons").setData(this.dataToPolygonFeature(this.visiblePoints)),t.setLayoutProperty("ncov-3d","visibility","visible"),t.setLayoutProperty("ncov-circle","visibility","none"),t.easeTo({pitch:60}))}},methods:{dataToPointFeature:function(e){return{type:"FeatureCollection",features:e.map((function(e,t){return{type:"Feature",properties:{count:e.confirmedCount,areaName:e.areaName},geometry:{type:"Point",coordinates:e.coordinates}}}))}},dataToPolygonFeature:function(e){var t=.15;return{type:"FeatureCollection",features:e.map((function(e,a){var n=Object(F["a"])(e.coordinates,2),i=n[0],r=n[1];return{type:"Feature",properties:{count:e.confirmedCount,areaName:e.areaName},geometry:{type:"Polygon",coordinates:[[[i-t,r+t],[i-t,r-t],[i+t,r-t],[i+t,r+t],[i-t,r+t]]]}}}))}},mapbox:function(){var e=this,t=new mapboxgl.Map({container:this.$refs.container,center:[104.299012,34.781634],zoom:2,minZoom:2,antialias:!0,style:{version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://map.geoq.cn/arcgis/rest/services/ChinaOnlineStreetGray/MapServer/tile/{z}/{y}/{x}"],tileSize:256},"raster-boundaries":{type:"raster",tiles:["https://map.geoq.cn/arcgis/rest/services/SimpleFeature/ChinaBoundaryLine/MapServer/tile/{z}/{y}/{x}"],tileSize:128},points:{type:"geojson",data:this.dataToPointFeature(this.visiblePoints)},polygons:{type:"geojson",data:this.dataToPolygonFeature(this.visiblePoints)}},layers:[{id:"tiles",type:"raster",source:"raster-tiles",minzoom:0,maxzoom:10,paint:{"raster-saturation":-1,"raster-brightness-min":.3,"raster-contrast":.2,"raster-opacity":.5}},{id:"boundaries",type:"raster",source:"raster-boundaries",maxzoom:4,paint:{"raster-saturation":-1,"raster-brightness-min":.5}}]}});t.on("zoom",(function(t){e.zoom=t.target.getZoom()})),window._map=t,this.map=t,t.addControl(new mapboxgl.NavigationControl({visualizePitch:!0}),"bottom-right"),t.on("load",(function(){t.addLayer({id:"ncov-circle",type:"circle",source:"points",paint:{"circle-radius":["interpolate",["linear"],["zoom"],2,["interpolate",["linear"],["get","count"]].concat(Object(H["a"])(A.Domains.reduce((function(e,t,a){return e.push(t,A.Radii[a]),e}),[]))),10,["interpolate",["linear"],["get","count"]].concat(Object(H["a"])(A.Domains.reduce((function(e,t,a){return e.push(t,4*A.Radii[a]),e}),[])))],"circle-color":["interpolate-hcl",["linear"],["get","count"]].concat(Object(H["a"])(A.Domains.reduce((function(e,t,a){return e.push(t,A.Colors[a]),e}),[]))),"circle-opacity":["interpolate",["linear"],["zoom"],2,.8,6,1],"circle-stroke-width":.1,"circle-stroke-color":"#fff"}}),t.addLayer({id:"ncov-3d",type:"fill-extrusion",source:"polygons",paint:{"fill-extrusion-color":["interpolate",["linear"],["get","count"]].concat(Object(H["a"])(A.Domains.reduce((function(e,t,a){return e.push(t,A.Colors[a]),e}),[]))),"fill-extrusion-base":0,"fill-extrusion-height":["*",["get","count"],1e3]}}),t.setLayoutProperty("ncov-3d","visibility","none")})),t.on("click",(function(a){var n=t.queryRenderedFeatures(a.point);n[0]?e.$store.commit("setPickedName",n[0].properties.areaName):e.$store.commit("setPickedName",null)}))}}},K=J,Q=(a("45d9"),a("a216"),Object(s["a"])(K,L,E,!1,null,"63710842",null)),U=Q.exports,X=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},ee=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"lds-ellipsis"},[a("div"),a("div"),a("div"),a("div")])}],te={name:"Spinner"},ae=te,ne=(a("c9f9"),Object(s["a"])(ae,X,ee,!1,null,"80cb9734",null)),ie=ne.exports,re=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"wrapper",staticClass:"wrapper"},[a("div",{ref:"container",staticClass:"container"}),a("label",{staticClass:"include-hubei"},[e._v(" 新增确诊"),a("br"),e._v(" 包含湖北省 "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.includeHubei,expression:"includeHubei"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.includeHubei)?e._i(e.includeHubei,null)>-1:e.includeHubei},on:{change:function(t){var a=e.includeHubei,n=t.target,i=!!n.checked;if(Array.isArray(a)){var r=null,o=e._i(a,r);n.checked?o<0&&(e.includeHubei=a.concat([r])):o>-1&&(e.includeHubei=a.slice(0,o).concat(a.slice(o+1)))}else e.includeHubei=i}}})])])},oe=[];a("ddb0");function ce(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function se(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(a),!0).forEach((function(t){Object(D["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ce(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ue={name:"TimeMinimap",data:function(){return{includeHubei:!0}},mounted:function(){this.initChart()},computed:se({},Object($["c"])(["paneSize","dataTime","playing"]),{},Object($["b"])(["incrementalData"])),watch:{includeHubei:function(e){this.view&&this.view.signal("includeHubei",e).runAsync()},paneSize:function(){this.$refs.container.style.display="none";var e=this.getContainerSize(),t=e.width,a=e.height;this.$refs.container.style.display="",this.view&&this.view.width(t).height(a).runAsync()},incrementalData:function(e){this.initChart()},dataTime:function(e){this.playing&&this.view&&this.view.signal("indexDate",e).runAsync()}},methods:{getContainerSize:function(){var e=this.$refs.wrapper,t=e.clientWidth,a=e.clientHeight;return{width:t,height:a}},initChart:function(){var e=this,t=this.$refs.container;if(!this.view&&t&&this.incrementalData){var a=le(se({},this.getContainerSize(),{values:this.incrementalData})),n=new vega.View(vega.parse(a),{renderer:"svg",container:t,hover:!0});n.runAsync(),this.view=n,window._view=n,n.addSignalListener("indexDate",(function(t,a){var n=dayjs(a).endOf("date");e.$store.commit("setDataTime",+n)}))}}}};function le(e){var t=e.width,a=e.height,n=e.values;return{$schema:"https://vega.github.io/schema/vega/v5.json",padding:0,width:t,height:a,autosize:"fit",data:[{name:"source",values:n,transform:[{type:"filter",expr:" includeHubei ? true : datum.provinceName != '湖北省' "},{field:"date",type:"timeunit",units:["year","month","date"],as:["yearmonth_date","yearmonth_date_end"]}]},{name:"dateCountMap",source:"source",transform:[{type:"aggregate",groupby:["yearmonth_date"],ops:["sum"],fields:["confirmedCountInc"],as:["sum_count"]},{type:"impute",field:"sum_count",key:"yearmonth_date",method:"value",value:0},{type:"pivot",field:"yearmonth_date",value:"sum_count"}]},{name:"table",source:"source",transform:[{type:"aggregate",groupby:["yearmonth_date","provinceName"],ops:["sum"],fields:["confirmedCountInc"],as:["sum_count"]},{type:"impute",field:"sum_count",groupby:["provinceName"],key:"yearmonth_date",method:"value",value:0},{type:"stack",groupby:["yearmonth_date"],field:"sum_count",sort:{field:["provinceName"],order:["descending"]},as:["sum_count_start","sum_count_end"],offset:"center"}]},{name:"textSeries",source:"table",transform:[{type:"aggregate",groupby:["provinceName"],ops:["argmax"],fields:["sum_count"],as:["argmax"]},{type:"filter",expr:"datum.argmax.sum_count > (includeHubei ? 1000 : 50)"}]}],signals:[{name:"includeHubei",value:!0},{name:"indexDate",value:n[n.length-1].date,on:[{events:"[mousedown, window:mouseup] > window:mousemove!, touchmove",update:"invert('x', clamp(x(), 0, width))"}]},{name:"dateCount",update:"data('dateCountMap')[0][datetime(year(indexDate), month(indexDate), date(indexDate))]"}],marks:[{name:"pathgroup",type:"group",from:{facet:{name:"faceted_path_main",data:"table",groupby:["provinceName"]}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:[{name:"marks",type:"area",sort:{field:'datum["yearmonth_date"]'},from:{data:"faceted_path_main"},encode:{update:{interpolate:{value:"monotone"},orient:{value:"vertical"},fill:{scale:"color",field:"provinceName"},fillOpacity:{value:1},x:{scale:"x",field:"yearmonth_date"},y:{scale:"y",field:"sum_count_end"},y2:{scale:"y",field:"sum_count_start"},defined:{signal:'isValid(datum["yearmonth_date"]) && isFinite(+datum["yearmonth_date"]) && isValid(datum["sum_count"]) && isFinite(+datum["sum_count"])'}},hover:{fillOpacity:{value:.5}}}}]},{type:"text",from:{data:"textSeries"},interactive:!1,encode:{update:{x:{scale:"x",field:"argmax.yearmonth_date"},y:{signal:"scale('y', 0.5 * (datum.argmax.sum_count_start + datum.argmax.sum_count_end))"},align:{signal:"width - scale('x', datum.argmax.yearmonth_date) < 40 ? 'right' : 'center' "},baseline:{value:"middle"},fontSize:{value:10},fontWeight:{value:"bolder"},text:{field:"provinceName"},fill:{scale:"color",field:"provinceName"},stroke:{value:"#fff"}}}},{type:"rule",interactive:!1,encode:{update:{x:{scale:"x",signal:"indexDate",offset:.5},y2:{field:{group:"height"}},stroke:{value:"firebrick"}}}},{type:"text",interactive:!1,encode:{update:{x:{scale:"x",signal:"indexDate",offset:-2},baseline:{value:"top"},align:{signal:" scale('x', indexDate) < 40 ? 'left' : 'right' "},text:{signal:"[dateCount ? '↑' + dateCount : '',  indexDate ? timeFormat(indexDate, '%m-%d') : '' ]"},fill:{value:"firebrick"},fontWeight:{value:"bolder"},stroke:{value:"#fff"}}}}],scales:[{name:"_x",type:"time",domain:{data:"table",field:"yearmonth_date"}},{name:"x",type:"time",domain:{signal:"[domain('_x')[0], timeOffset('date', domain('_x')[1]) - 1]"},range:[0,{signal:"width"}]},{name:"y",type:"linear",domain:{data:"table",fields:["sum_count_start","sum_count_end"]},range:[{signal:"height"},0],nice:!0,zero:!0},{name:"color",type:"ordinal",domain:{data:"table",field:"provinceName",sort:!0},range:{scheme:"category20b"}}],axes:[{scale:"x",orient:"bottom",gridScale:"y",grid:!0,tickCount:"day",domain:!1,labels:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:0},{scale:"x",orient:"bottom",grid:!0,gridColor:"#aaa",domain:!1,ticks:!1,labelFlush:!0,labelOverlap:!0,tickCount:{signal:"ceil(width/40)"},format:"%m-%d",zindex:0}]}}var de=ue,pe=(a("b869"),a("0c08"),Object(s["a"])(de,re,oe,!1,null,"5924d19d",null)),me=pe.exports;function fe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function he(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(a),!0).forEach((function(t){Object(D["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ve={name:"home",components:{Map:U,Spinner:ie,TimeMinimap:me},data:function(){return{updateTime:dayjs(k).format("YYYY-MM-DD HH:mm")}},computed:he({},Object($["c"])(["pickedName","dataTime","playing"]),{},Object($["c"])({size:"paneSize"}),{loading:function(){return"loading"===this.$store.state.loadState},loaded:function(){return"loaded"===this.$store.state.loadState},dataDate:function(){return dayjs(this.dataTime).format("MM-DD")},pointInfo:function(){var e=this,t=this.$store.getters.visiblePoints,a=this.pickedName&&t.find((function(t){return t.areaName===e.pickedName}));return a?"".concat(a.areaName,": ").concat(a.confirmedCount):""},mapType:{get:function(){return this.$store.state.mapType},set:function(e){this.$store.commit("setMapType",e)}},showAbout:{get:function(){return this.$store.state.showAbout},set:function(e){this.$store.commit("setShowAbout",e)}}}),methods:{toggleSize:function(){var e="small"===this.size?"large":"small";this.$store.commit("setPaneSize",e)},togglePlay:function(){this.$store.commit("togglePlay")}}},ye=ve,ge=(a("1807"),Object(s["a"])(ye,C,j,!1,null,"3d2f1220",null)),be=ge.exports;n["a"].use(_["a"]);var we=[{path:"/",name:"home",component:be}],xe=new _["a"]({routes:we}),Oe=xe,_e=(a("c740"),a("dca8"),a("3ca3"),a("96cf"),a("1da1"));function Ce(e){var t=[],a=0;function n(e,n){if(n.confirmedCount){var i=LocDoc[e];if(i){var r={coordinates:i.location,confirmedCount:n.confirmedCount,provinceName:i.province,cityName:i.city||n.cityName,areaName:i.province+(i.city||n.cityName),data:n};t.push(r),a=Math.max(a,n.confirmedCount)}else console.error("cannot find:",e)}}return e.forEach((function(e){var t=e.provinceName;e.cities.length?e.cities.forEach((function(e){n(t+e.cityName,e)})):n(t,e)})),Object.freeze(t),t}a("a15b"),a("07ac");var je=a("d4ec"),De=a("bee2"),Pe=function(){function e(){Object(je["a"])(this,e),this.data=null,this.dateFrom=0,this.dateTo=0}return Object(De["a"])(e,[{key:"load",value:function(){var e=Object(_e["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.data){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,d3.csv("".concat("https://cdn.jsdelivr.net/gh/yuqianma/ncov-map@gh-pages/","before0124.csv"),(function(e){var t=e["地区"],a=LocDoc[t];if(!a)throw t;return{caseNum:+e["病例数"],date:new Date(dayjs(e["发病日期"]).add(1,"day").endOf("day")),areaName:e["地区"],loc:a,infoSource:e["消息来源"],note:e["备注"]}}));case 4:t=e.sent,this.data=t.sort((function(e,t){return e.date-t.date})),this.dateFrom=this.data[0].date,this.dateTo=this.data[this.data.length-1].date;case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"aggregateProvinceMap",value:function(){var e={};return this.data.forEach((function(t){var a=t.loc,n=e[a.province]=e[a.province]||{confirmedCount:0,provinceName:a.province};n.confirmedCount+=t.caseNum})),e}},{key:"queryIncOfDate",value:function(e){return e=new Date(dayjs(e).endOf("day")),this.data.filter((function(t){return t.date-e===0}))}},{key:"getProvinceIncOfDate",value:function(e){e=new Date(dayjs(e).endOf("day"));var t=this.queryIncOfDate(e),a={};return t.forEach((function(t){var n=t.loc,i=a[n.province]=a[n.province]||{date:e,confirmedCountInc:0,provinceName:n.province};i.confirmedCountInc+=t.caseNum})),Object.values(a)}},{key:"queryPointsByDate",value:function(e){var t=new Date(e);return this.data.filter((function(e){return e.date<=t}))}},{key:"getVisiblePointsByDate",value:function(e){var t=this.queryPointsByDate(e),a={};return t.forEach((function(e){var t=e.loc.location,n=t.join(","),i=a[n]=a[n]||{coordinates:t,confirmedCount:0,provinceName:e.loc.province,cityName:e.loc.city,areaName:e.loc.province+e.loc.city,data:[]};i.confirmedCount+=e.caseNum,i.data.push(e)})),Object.values(a)}}]),e}(),ze=new Pe;function Se(e){return e.reduce((function(e,t){return e+t.confirmedCountInc}),0)}function ke(e){var t=e.dateFrom,a=e.formerData,n=e.areaStats,i=[],r={},o=dayjs(a.dateFrom);while(o<=a.dateTo){var c=a.getProvinceIncOfDate(o);r[+o]=Se(c),i.push.apply(i,Object(H["a"])(c)),o=o.add(1,"day")}var s=a.aggregateProvinceMap();n.forEach((function(e){var t=new Date(dayjs(e.time).endOf("day")),a={},n=[];e.forEach((function(e){var i,r=e.provinceName;LocDoc[r]&&(r=LocDoc[r].province),a[r]||(a[r]=e),i=s[r]?e.confirmedCount-s[r].confirmedCount:e.confirmedCount,n.push({date:t,confirmedCountInc:i,provinceName:r})})),i.push.apply(i,n),r[+t]=Se(n),s=a}));var u=i.filter((function(e){return e.date>=t}));return u.dateMap=r,Object.freeze(u),u}function Te(){return Promise.all(AreaStatIndex.map((function(e){return fetch("".concat("https://cdn.jsdelivr.net/gh/yuqianma/ncov-map@gh-pages/","dxy/").concat(e)).then((function(e){return e.text()})).then((function(t){var a=P(t);return a.time=z(e),Object.freeze(a)}))})))}n["a"].use($["a"]);var Ne=new $["a"].Store({state:{mapType:"circle",areaStats:[],pickedName:null,dataTime:k,loadState:null,paneSize:"small",playing:!1,showAbout:!1},getters:{visiblePoints:function(e){var t=e.areaStats,a=e.dataTime;if(a>=k)return Ce(window.getAreaStat);if(a>N){var n=t.findIndex((function(e){return e.time>+a}));return n=Math.max(0,Math.min(n-1,t.length)),Ce(t[n])}return ze.getVisiblePointsByDate(a)},incrementalData:function(e){var t=e.areaStats;return t.length?ke({dateFrom:T[0],formerData:ze,areaStats:t}):null}},mutations:{setLoading:function(e){e.loadState="loading"},setDataTime:function(e,t){e.dataTime=t>=k?k:t},saveAllData:function(e,t){e.areaStats=t,e.loadState="loaded"},setPickedName:function(e,t){return e.pickedName=t},setMapType:function(e,t){return e.mapType=t},setPaneSize:function(e,t){return e.paneSize=t},togglePlay:function(e,t){return e.playing=!e.playing},setShowAbout:function(e,t){return e.showAbout=t}},actions:{fetchAllData:function(){var e=Object(_e["a"])(regeneratorRuntime.mark((function e(t){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.state,n=t.commit,!a.loadState){e.next=3;break}return e.abrupt("return");case 3:return n("setLoading"),console.time("load"),e.next=7,ze.load();case 7:return e.next=9,Te().then((function(e){console.timeEnd("load"),n("saveAllData",e)}));case 9:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},modules:{}}),Me=-1;Ne.watch((function(e){return e.playing}),(function(e){if(e){var t=Ne.state.dataTime,a=dayjs(T[1]).endOf("day");a.isSame(t,"date")&&(t=T[0]),t=dayjs(t).endOf("day"),Ne.commit("setDataTime",t),Me=setInterval((function(){t=t.add(1,"day").endOf("day"),t<=a&&Ne.state.playing?Ne.commit("setDataTime",t):(clearInterval(Me),Ne.commit("togglePlay"))}),100)}else clearInterval(Me)})),Ne.dispatch("fetchAllData").then((function(){}));var Ae=Ne;n["a"].config.productionTip=!1;new n["a"]({router:Oe,store:Ae,render:function(e){return e(O)}}).$mount("#app")},"6a61":function(e,t,a){},"6b66":function(e,t,a){},"85ec":function(e,t,a){},8614:function(e,t,a){},9261:function(e,t,a){},a216:function(e,t,a){"use strict";var n=a("4ff7"),i=a.n(n);i.a},aca4:function(e,t,a){"use strict";var n=a("8614"),i=a.n(n);i.a},b309:function(e,t,a){},b869:function(e,t,a){"use strict";var n=a("9261"),i=a.n(n);i.a},c6f4:function(e,t,a){},c9f9:function(e,t,a){"use strict";var n=a("6b66"),i=a.n(n);i.a},ea22:function(e,t,a){"use strict";var n=a("c6f4"),i=a.n(n);i.a},fb05:function(e,t,a){}});