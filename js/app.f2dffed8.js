(function(e){function t(t){for(var r,i,c=t[0],s=t[1],u=t[2],d=0,p=[];d<c.length;d++)i=c[d],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&p.push(a[i][0]),a[i]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);l&&l(t);while(p.length)p.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,c=1;c<n.length;c++){var s=n[c];0!==a[s]&&(r=!1)}r&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},a={app:0},o=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="https://cdn.jsdelivr.net/gh/yuqianma/ncov-map@gh-pages/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var r=n("85ec"),a=n.n(r);a.a},1922:function(e,t,n){"use strict";var r=n("9c9f"),a=n.n(r);a.a},5490:function(e,t,n){"use strict";var r=n("a6b6"),a=n.n(r);a.a},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("Map"),n("router-view")],1)},o=[],i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"container",class:{"show-label":e.showLabel},attrs:{id:"map-container"}})},c=[],s=(n("a4d3"),n("4de4"),n("4160"),n("d81d"),n("e439"),n("dbb4"),n("b64b"),n("159b"),n("3835")),u=n("ade3"),l=n("2f62");function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){Object(u["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f={name:"Map",data:function(){return{showLabel:!1}},mounted:function(){this.mapbox()},computed:p({},Object(l["c"])(["mapType"]),{},Object(l["b"])(["visiblePoints"])),watch:{visiblePoints:function(e){"circle"===this.mapType?this.map.getSource("points").setData(this.dataToPointFeature(e)):this.map.getSource("polygons").setData(this.dataToPolygonFeature(e))},mapType:function(e){var t=this.map;"circle"===e?(t.setLayoutProperty("ncov-circle","visibility","visible"),t.setLayoutProperty("ncov-3d","visibility","none"),t.easeTo({pitch:0})):(t.setLayoutProperty("ncov-3d","visibility","visible"),t.setLayoutProperty("ncov-circle","visibility","none"),t.easeTo({pitch:60}))}},methods:{dataToPointFeature:function(e){return{type:"FeatureCollection",features:e.map((function(e,t){return{type:"Feature",properties:{count:e.confirmedCount,areaName:e.areaName,idx:t},geometry:{type:"Point",coordinates:e.coordinates}}}))}},dataToPolygonFeature:function(e){var t=.15;return{type:"FeatureCollection",features:e.map((function(e,n){var r=Object(s["a"])(e.coordinates,2),a=r[0],o=r[1];return{type:"Feature",properties:{count:e.confirmedCount,areaName:e.areaName,idx:n},geometry:{type:"Polygon",coordinates:[[[a-t,o+t],[a-t,o-t],[a+t,o-t],[a+t,o+t],[a-t,o+t]]]}}}))}},mapbox:function(){var e=this,t=new mapboxgl.Map({container:this.$refs.container,center:[104.299012,34.781634],zoom:2,antialias:!0,style:{version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://map.geoq.cn/arcgis/rest/services/ChinaOnlineStreetGray/MapServer/tile/{z}/{y}/{x}"],tileSize:256},"raster-boundaries":{type:"raster",tiles:["https://map.geoq.cn/arcgis/rest/services/SimpleFeature/ChinaBoundaryLine/MapServer/tile/{z}/{y}/{x}"],tileSize:128},points:{type:"geojson",data:this.dataToPointFeature(this.visiblePoints)},polygons:{type:"geojson",data:this.dataToPolygonFeature(this.visiblePoints)}},layers:[{id:"tiles",type:"raster",source:"raster-tiles",minzoom:0,maxzoom:10,paint:{"raster-saturation":-1,"raster-brightness-min":.3,"raster-contrast":.2,"raster-opacity":.5}},{id:"boundaries",type:"raster",source:"raster-boundaries",maxzoom:4,paint:{"raster-saturation":-1,"raster-brightness-min":.5}}]}});window._map=t,this.map=t,t.addControl(new mapboxgl.NavigationControl({visualizePitch:!0}),"bottom-right"),t.on("load",(function(){t.addLayer({id:"ncov-circle",type:"circle",source:"points",paint:{"circle-radius":["interpolate",["linear"],["zoom"],4,["interpolate",["linear"],["get","count"],1,2,1e3,20],10,["interpolate",["linear"],["get","count"],1,5,1e3,100]],"circle-color":["interpolate",["linear"],["get","count"],1,"rgba(33,102,172,0)",10,"rgb(103,169,207)",50,"rgb(209,229,240)",100,"rgb(253,219,199)",500,"rgb(239,138,98)",1e3,"rgb(178,24,43)"],"circle-stroke-width":.1,"circle-stroke-color":"#888"}}),t.addLayer({id:"ncov-3d",type:"fill-extrusion",source:"polygons",paint:{"fill-extrusion-color":["interpolate",["linear"],["get","count"],1,"rgb(253,219,199)",1e3,"rgb(178,24,43)"],"fill-extrusion-base":0,"fill-extrusion-height":["*",["get","count"],1e3]}}),t.setLayoutProperty("ncov-3d","visibility","none")})),t.on("click",(function(n){var r=t.queryRenderedFeatures(n.point);r[0]?e.$store.commit("setPickedIdx",r[0].properties.idx):e.$store.commit("setPickedIdx",-1)}))}}},m=f,v=(n("5490"),n("2877")),h=Object(v["a"])(m,i,c,!1,null,null,null),y=h.exports,b={components:{Map:y}},g=b,O=(n("034f"),Object(v["a"])(g,a,o,!1,null,null,null)),w=O.exports,j=n("8c4f"),x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("div",{staticClass:"title"},[e._v("确诊数量")]),n("div",{staticClass:"point-info"},[e._v(e._s(e.pointInfo))]),n("div",{staticClass:"pane"},[n("div",{staticClass:"time"},[e._v(e._s(e.formattedDataTime))]),e.loading?n("Spinner"):e._e(),e.loaded||e.loading?e._e():n("div",{staticClass:"load",on:{click:e.load}},[e._v(" 查看 "+e._s(e.formattedDateMin)+"~"+e._s(e.formattedDateMax)+" 数据 ")]),e.loaded?n("input",{directives:[{name:"model",rawName:"v-model",value:e.dataTime,expression:"dataTime"}],attrs:{type:"range",min:e.dateMin,max:e.dateMax},domProps:{value:e.dataTime},on:{__r:function(t){e.dataTime=t.target.value}}}):e._e(),e.loaded?n("div",{staticClass:"range"},[e._v(" "+e._s(e.formattedDateMin)+" ~ "+e._s(e.formattedDateMax)+" ")]):e._e(),n("div",{staticClass:"control"},[e._v(" change to "),n("button",{on:{click:e.toggleMapType}},[e._v(e._s(e.changeType))])])],1)])},P=[],D=(n("99af"),n("96cf"),n("1da1"));n("ac1f"),n("5319");function T(e){return new Function("var window = {}; ".concat(e,"; for(let k in window) {return window[k];}"))()}function _(e){return LocDoc[e]?LocDoc[e].location:(console.error(e),[])}function M(e){return+e.replace(/[^\d]/g,"")}var C=window.AreaStatIndex,S=M(C[C.length-1]);window.getAreaStat.time=S;var k=[new Date("2020-01-15"),new Date(S)],E=new Date("2020-01-24"),$=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},N=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"lds-ellipsis"},[n("div"),n("div"),n("div"),n("div")])}],F={name:"Spinner"},L=F,z=(n("e1f7"),Object(v["a"])(L,$,N,!1,null,"ba5a3b68",null)),I=z.exports;function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){Object(u["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var R={name:"home",components:{Spinner:I},data:function(){return{dateMin:+k[0],dateMax:+k[1],loading:!1}},computed:A({},Object(l["c"])(["mapType","loaded"]),{changeType:function(){return"circle"===this.mapType?"3D":"circle"},formattedDateMin:function(){return dayjs(this.dateMin).format("MM-DD")},formattedDateMax:function(){return dayjs(this.dateMax).format("MM-DD")},dataTime:{get:function(){return+this.$store.state.dataTime},set:function(e){this.$store.commit("setDataTime",+e)}},formattedDataTime:function(){return dayjs(this.$store.state.dataTime).format("YYYY-MM-DD HH:mm")},pointInfo:function(){var e=this.$store.getters.visiblePoints[this.$store.state.pickedIdx];return e?"".concat(e.areaName,": ").concat(e.confirmedCount):""}}),methods:{load:function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.next=3,this.$store.dispatch("fetchAllData");case 3:this.loading=!1;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),toggleMapType:function(){this.$store.commit("setMapType",this.changeType)}}},B=R,Y=(n("1922"),Object(v["a"])(B,x,P,!1,null,"5aaa6ca1",null)),H=Y.exports;r["a"].use(j["a"]);var J=[{path:"/",name:"home",component:H}],V=new j["a"]({routes:J}),G=V;n("c740"),n("dca8"),n("d3b7"),n("3ca3"),n("ddb0");function K(e){var t=[],n=0;function r(e,r){if(r.confirmedCount){var a=_(e);r.areaName=e;var o={coordinates:a,confirmedCount:r.confirmedCount,areaName:e,data:r};t.push(o),n=Math.max(n,r.confirmedCount)}}return e.forEach((function(e){var t=e.provinceName;e.cities.length?e.cities.forEach((function(e){r(t+e.cityName,e)})):r(t,e)})),Object.freeze(t),t}n("a15b"),n("07ac");var Q=n("d4ec"),U=n("bee2"),W=function(){function e(){Object(Q["a"])(this,e),this.data=null}return Object(U["a"])(e,[{key:"load",value:function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.data){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,d3.csv("".concat("https://cdn.jsdelivr.net/gh/yuqianma/ncov-map@gh-pages/","before0124.csv"),(function(e){var t=e["地区"],n=LocDoc[t];if(!n)throw t;return{confirmedCount:+e["病例数"],date:new Date(e["发病日期"]),areaName:e["地区"],loc:n,infoSource:e["消息来源"],note:e["备注"]}}));case 4:t=e.sent,this.data=t.sort((function(e,t){return e.date-t.date}));case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"queryPointsByDate",value:function(e){var t=new Date(e);return this.data.filter((function(e){return e.date<=t}))}},{key:"getVisiblePointsByDate",value:function(e){var t=this.queryPointsByDate(e),n={};return t.forEach((function(e){var t=e.loc.location,r=t.join(","),a=n[r]=n[r]||{coordinates:t,confirmedCount:0,areaName:e.loc.province+e.loc.city,data:[e]};a.confirmedCount+=+e.confirmedCount,a.data.push(e)})),Object.values(n)}}]),e}(),X=new W,Z=n("2909");function ee(e){var t=[],n=dayjs(k[0]),r=function(){var r=e.queryPointsByDate(n),a={date:+n,confirmedCount:0,provinces:[]},o={};r.forEach((function(e){o[e.loc.province]=o[e.loc.province]||0,o[e.loc.province]+=e.confirmedCount,a.confirmedCount+=e.confirmedCount})),a.provinces=Object.keys(o).map((function(e){return{provinceName:e,confirmedCount:o[e]}})),t.push(a),n=n.add(1,"day")};while(n<E)r();return t}function te(e){var t=[];return e.forEach((function(e){var n={date:e.time,confirmedCount:0,provinces:e};e.forEach((function(e){n.confirmedCount+=e.confirmedCount})),t.push(n)})),t}function ne(e){var t=e.formerData,n=e.areaStats;return[].concat(Object(Z["a"])(ee(t)),Object(Z["a"])(te(n)))}function re(){return Promise.all(AreaStatIndex.map((function(e){return fetch("".concat("https://cdn.jsdelivr.net/gh/yuqianma/ncov-map@gh-pages/","dxy/").concat(e)).then((function(e){return e.text()})).then((function(t){var n=T(t);return n.time=M(e),Object.freeze(n)}))})))}r["a"].use(l["a"]);var ae=!1,oe=new l["a"].Store({state:{mapType:"circle",areaStats:[],pickedIdx:-1,dataTime:S,loaded:!1},getters:{visiblePoints:function(e){var t=e.areaStats,n=e.dataTime;if(n===S)return K(window.getAreaStat);if(n>E){var r=t.findIndex((function(e){return e.time>+n}));return r=Math.max(0,Math.min(r-1,t.length)),K(t[r])}return X.getVisiblePointsByDate(n)},timeSeriesData:function(e){var t=e.areaStats;return ne({formerData:X,areaStats:t})}},mutations:{setDataTime:function(e,t){e.dataTime=t},saveAllData:function(e,t){e.areaStats=t,e.loaded=!0},setPickedIdx:function(e,t){return e.pickedIdx=t},setMapType:function(e,t){return e.mapType=t}},actions:{fetchAllData:function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.commit,!ae){e.next=3;break}return e.abrupt("return");case 3:return ae=!0,console.time("load"),e.next=7,X.load();case 7:return e.next=9,re().then((function(e){n("saveAllData",e),n("setDataTime",k[0])}));case 9:console.timeEnd("load");case 10:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},modules:{}}),ie=oe;r["a"].config.productionTip=!1;new r["a"]({router:G,store:ie,render:function(e){return e(w)}}).$mount("#app")},"85ec":function(e,t,n){},"9c9f":function(e,t,n){},a6b6:function(e,t,n){},e1f7:function(e,t,n){"use strict";var r=n("ff9f"),a=n.n(r);a.a},ff9f:function(e,t,n){}});